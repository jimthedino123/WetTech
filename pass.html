<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Floptropican Passport Maker</title>

<style>
body {
    font-family: Arial, sans-serif;
    background:#e9f7e2;
    margin:0;
    padding:20px;
}

.container {
    max-width:900px;
    margin:auto;
    background:white;
    padding:20px;
    border-radius:10px;
}

input, button {
    padding:8px;
    margin-top:10px;
    width:100%;
}

.page-preview {
    border:1px solid #ccc;
    margin-top:20px;
    padding:20px;
    background:white;
}

.passport-page {
    width: 600px;
    height: 800px;
    position: relative;
    background: #d9f0d2;
    margin-bottom: 30px;
    overflow:hidden;
}

/* FRONT COVER */
.cover-bg {
    background:#cfe7c8;
}

.cover-coa {
    position:absolute;
    top:27%;
    left:50%;
    transform:translateX(-50%);
    width:40%;
    opacity:0.9;
}

.cover-flags img {
    width:65px;
    margin-right:10px;
}

.cover-flags {
    position:absolute;
    top:20px;
    left:20px;
    display:flex;
}

.cover-title {
    position:absolute;
    bottom:110px;
    left:50%;
    transform:translateX(-50%);
    text-align:center;
    font-size:22px;
    font-weight:bold;
}

.scan-symbol {
    position:absolute;
    bottom:30px;
    left:50%;
    transform:translateX(-50%);
    width:60px;
}

/* IDENTITY PAGE */
.id-page {
    background:#ffffff;
    padding:40px;
}

.id-photo {
    width:150px;
    height:200px;
    border:1px solid #aaa;
    object-fit:cover;
}

.id-info {
    margin-top:20px;
    font-size:18px;
}

/* STAMP PAGE */
.stamp-page {
    background:white;
    padding:40px;
    font-size:22px;
    color:#444;
}

</style>
</head>

<body>

<div class="container">
    <h2>Floptropican Passport Generator</h2>

    <label>Your Name</label>
    <input id="nameInput" placeholder="Enter full name">

    <label>Date of Birth</label>
    <input id="dobInput" placeholder="DD/MM/YYYY">

    <label>Passport Number</label>
    <input id="passNumInput" placeholder="FLO-XXXXXX">

    <label>Upload Your Photo</label>
    <input type="file" id="photoInput" accept="image/*">

    <label>coa.png</label><input type="file" id="coaInput" accept="image/*">
    <label>fl1.png</label><input type="file" id="fl1Input" accept="image/*">
    <label>fl2.png</label><input type="file" id="fl2Input" accept="image/*">
    <label>d.png</label><input type="file" id="dInput" accept="image/*">

    <button onclick="generatePDF()">Generate Passport PDF</button>
</div>

<!-- Hidden previews for PDF rendering -->

<div id="page1" class="passport-page cover-bg" style="display:none;">
    <div class="cover-flags">
        <img id="fl1Img">
        <img id="fl2Img">
    </div>
    <img id="coaImg" class="cover-coa">
    <div class="cover-title">
        Republic of Floptropica Passport <br>
        弗洛普热西亚共和国护照
    </div>
    <img id="scanImg" class="scan-symbol">
</div>

<div id="page2" class="passport-page" style="display:none; background:white; padding:40px;">
    <h2>Identity Information</h2>
    <img id="photoPreview" class="id-photo">
    <div class="id-info" id="idText"></div>
</div>

<div id="page3" class="passport-page stamp-page" style="display:none;">
    <h2>Visa & Entry Stamps</h2>
    <p>Space for stamps...</p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
function fileToDataURL(file, callback) {
    const reader = new FileReader();
    reader.onload = function(e){ callback(e.target.result); };
    reader.readAsDataURL(file);
}

async function generatePDF() {
    const { jsPDF } = window.jspdf;
    let pdf = new jsPDF({ unit:"px", format:[600,800] });

    // Load images
    const files = {
        coa: document.getElementById("coaInput").files[0],
        fl1: document.getElementById("fl1Input").files[0],
        fl2: document.getElementById("fl2Input").files[0],
        dimg: document.getElementById("dInput").files[0],
        photo: document.getElementById("photoInput").files[0]
    };

    // Convert image files to Data URLs
    const urls = {};
    for (const key in files) {
        if (files[key]) {
            urls[key] = await new Promise(res => fileToDataURL(files[key], res));
        }
    }

    // Insert into preview DOM
    if (urls.coa) document.getElementById("coaImg").src = urls.coa;
    if (urls.fl1) document.getElementById("fl1Img").src = urls.fl1;
    if (urls.fl2) document.getElementById("fl2Img").src = urls.fl2;
    if (urls.dimg) document.getElementById("scanImg").src = urls.dimg;
    if (urls.photo) document.getElementById("photoPreview").src = urls.photo;

    // Fill ID text
    document.getElementById("idText").innerHTML =
        `<strong>Name:</strong> ${document.getElementById("nameInput").value}<br>
         <strong>D.O.B:</strong> ${document.getElementById("dobInput").value}<br>
         <strong>Passport No.:</strong> ${document.getElementById("passNumInput").value}`;

    // Render each page
    async function addPageFromDiv(divId, isFirst) {
        let node = document.getElementById(divId);
        let canvas = await html2canvas(node, { scale:2 });
        let img = canvas.toDataURL("image/png");
        if (!isFirst) pdf.addPage();
        pdf.addImage(img, "PNG", 0, 0, 600, 800);
    }

    // Load html2canvas dynamically
    if (!window.html2canvas) {
        await new Promise(res => {
            let s = document.createElement("script");
            s.src = "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
            s.onload = res;
            document.body.appendChild(s);
        });
    }

    await addPageFromDiv("page1", true);
    await addPageFromDiv("page2", false);
    await addPageFromDiv("page3", false);

    pdf.save("Floptropica_Passport.pdf");
}
</script>

</body>
</html>