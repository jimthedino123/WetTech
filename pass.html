<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Floptropican Passport PDF Generator</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<style>
  :root{
    --passport-width: 850px;
  }

  body{
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    margin: 20px;
    background: #f3f4f6;
    color: #111827;
  }

  h1 { margin-bottom: 6px; font-size: 20px; }
  p.lead { margin-top:0; color:#374151; }

  .layout{
    display:flex;
    gap:18px;
    align-items:flex-start;
    flex-wrap:wrap;
  }

  .controls{
    min-width:280px;
    max-width:360px;
    background:#fff;
    padding:14px;
    border-radius:10px;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
  }

  label{ display:block; margin-top:10px; font-weight:600; font-size:13px; }
  input[type="text"], input[type="date"], input[type="file"] {
    width:100%;
    margin-top:6px;
    padding:8px;
    border-radius:6px;
    border:1px solid #d1d5db;
    box-sizing:border-box;
  }

  .btn{
    margin-top:12px;
    padding:10px 14px;
    background:#0b74ff;
    color:white;
    border-radius:8px;
    font-weight:700;
    border:0;
    cursor:pointer;
  }
  .btn.secondary{ background:#6b7280; }

  .preview-wrap{
    width:var(--passport-width);
    max-width:100%;
  }

  .passport-preview{
    width:100%;
    box-shadow:0 12px 30px rgba(2,6,23,0.12);
    border-radius:6px;
    overflow:hidden;
    background: #fff;
  }

  .page{
    width:100%;
    height:1200px;
    position:relative;
    page-break-after:always;
  }

  .front{
    background: #9fbf86;
    background: linear-gradient(180deg, rgba(157,187,140,0.15), rgba(157,187,140,0.25));
    display:flex;
    justify-content:center;
    align-items:center;
  }

  .top-left-flags{
    position:absolute;
    top:20px;
    left:20px;
    display:flex;
    gap:6px;
  }
  .top-left-flags img{
    width:58px;
    height:38px;
    object-fit:cover;
    border-radius:4px;
    border:1px solid rgba(0,0,0,0.08);
  }

  .coa-wrap{
    display:flex;
    align-items:center;
    justify-content:center;
    height:calc(100% - 220px);
    width:100%;
  }
  .coa-wrap img{
    width:330px;
    height:330px;
    object-fit:contain;
  }

  /* NEW — scan symbol at bottom */
  .scan-symbol{
    position:absolute;
    bottom:95px;
    left:50%;
    transform:translateX(-50%);
  }
  .scan-symbol img{
    width:80px;
    height:auto;
    object-fit:contain;
    opacity:0.95;
  }

  .front-footer{
    position:absolute;
    bottom:20px;
    width:100%;
    text-align:center;
  }
  .front-footer .title{
    font-size:20px;
    font-weight:800;
  }
  .front-footer .mandarin{
    font-size:14px;
    margin-top:4px;
    font-weight:600;
  }

  /* INNER PAGE */
  .inner{
    background:linear-gradient(180deg,#fff,#f8fafc);
    padding:28px 36px;
    display:flex;
    gap:20px;
  }

  .bio{
    width:40%;
    border:1px dashed rgba(0,0,0,0.1);
    padding:14px;
    border-radius:8px;
  }

  .photo-box{
    width:100%;
    height:320px;
    border-radius:6px;
    overflow:hidden;
    background:#e5ecec;
  }

  .photo{
    width:100%;
    height:100%;
    background-position:center;
    background-size:cover;
  }

  .data{ margin-top:12px; }
  .data-item{
    margin-bottom:8px;
    display:flex;
    gap:6px;
  }
  .data-item .label{
    font-weight:700;
    width:110px;
  }
  .data-item .value{
    font-weight:800;
  }

  .stamps{
    width:60%;
    background:#f5f7f8;
    border-radius:8px;
    padding:12px;
  }

  .stamp-grid{
    margin-top:10px;
    display:grid;
    gap:12px;
    grid-template-columns:repeat(3,1fr);
  }
  .stamp{
    border:2px dashed rgba(0,0,0,0.08);
    min-height:130px;
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:#4b5563;
  }

  .a4-page{
    width:210mm;
    min-height:297mm;
  }

  @media(max-width:900px){
    .layout{ flex-direction:column; }
  }
</style>
</head>
<body>

<h1>Floptropica Passport — PDF Generator</h1>
<p class="lead">Now includes the official bottom scan symbol.</p>

<div class="layout">
  <div class="controls">

    <label>Name</label>
    <input id="name" type="text" value="Alex Flop">

    <label>Date of birth</label>
    <input id="dob" type="date" value="2010-01-01">

    <label>Upload photo (required)</label>
    <input id="photoInput" type="file" accept="image/*">

    <label>Replace coat of arms (optional)</label>
    <input id="coaInput" type="file" accept="image/*">

    <label>Replace flag 1 (optional)</label>
    <input id="fl1Input" type="file" accept="image/*">

    <label>Replace flag 2 (optional)</label>
    <input id="fl2Input" type="file" accept="image/*">

    <label>Replace scan symbol (optional, default: d.png)</label>
    <input id="scanInput" type="file" accept="image/*">

    <button class="btn secondary" id="previewBtn">Update Preview</button>
    <button class="btn" id="generate">Generate PDF</button>

  </div>

  <div class="preview-wrap">
    <div id="preview" class="passport-preview">

      <!-- FRONT PAGE -->
      <div class="page front a4-page" id="page-front">

        <div class="top-left-flags">
          <img id="flag1" src="fl1.png" onerror="this.style.display='none'">
          <img id="flag2" src="fl2.png" onerror="this.style.display='none'">
        </div>

        <div class="coa-wrap">
          <img id="coaImg" src="coa.png" onerror="this.style.display='none'">
        </div>

        <!-- NEW: Scan symbol -->
        <div class="scan-symbol">
          <img id="scanImg" src="d.png" onerror="this.style.display='none'">
        </div>

        <div class="front-footer">
          <div class="title">Republic of Floptropica Passport</div>
          <div class="mandarin">弗洛普特里卡共和国护照</div>
        </div>
      </div>

      <!-- INNER PAGE -->
      <div class="page inner a4-page" id="page-inner">

        <div class="bio">
          <div class="photo-box">
            <div id="photoPreview" class="photo"></div>
          </div>

          <div class="data">
            <div class="data-item">
              <div class="label">Name</div>
              <div id="pv-name" class="value">Alex Flop</div>
            </div>

            <div class="data-item">
              <div class="label">DOB</div>
              <div id="pv-dob" class="value">2010-01-01</div>
            </div>

            <div class="data-item">
              <div class="label">Nationality</div>
              <div class="value">Floptropican</div>
            </div>

            <div class="data-item">
              <div class="label">Passport No.</div>
              <div id="pv-passno" class="value">FLP-0000001</div>
            </div>
          </div>
        </div>

        <div class="stamps">
          <strong>Stamps & Visas</strong>
          <div class="stamp-grid">
            <div class="stamp">STAMP</div>
            <div class="stamp">STAMP</div>
            <div class="stamp">STAMP</div>
            <div class="stamp">STAMP</div>
            <div class="stamp">STAMP</div>
            <div class="stamp">STAMP</div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
(function(){

  const nameEl = document.getElementById('name');
  const dobEl = document.getElementById('dob');

  const pvName = document.getElementById('pv-name');
  const pvDob = document.getElementById('pv-dob');
  const pvPassNo = document.getElementById('pv-passno');

  const photoInput = document.getElementById('photoInput');
  const photoPreview = document.getElementById('photoPreview');

  const coaInput = document.getElementById('coaInput');
  const fl1Input = document.getElementById('fl1Input');
  const fl2Input = document.getElementById('fl2Input');
  const scanInput = document.getElementById('scanInput');

  const coaImg = document.getElementById('coaImg');
  const flag1 = document.getElementById('flag1');
  const flag2 = document.getElementById('flag2');
  const scanImg = document.getElementById('scanImg');

  function readFile(file){
    return new Promise(res=>{
      if(!file) return res(null);
      const r = new FileReader();
      r.onload=()=>res(r.result);
      r.readAsDataURL(file);
    });
  }

  function updatePreview(){
    pvName.textContent = nameEl.value;
    pvDob.textContent = dobEl.value;
    pvPassNo.textContent = "FLP-" + (Math.random()*1e7|0);
  }

  photoInput.addEventListener('change', async e=>{
    const f = e.target.files[0];
    if(!f) return;
    const url = await readFile(f);
    photoPreview.style.backgroundImage = `url('${url}')`;
  });

  coaInput.addEventListener('change', async e=>{
    const f = e.target.files[0];
    if(!f) return;
    coaImg.src = await readFile(f);
  });

  fl1Input.addEventListener('change', async e=>{
    const f = e.target.files[0];
    if(!f) return;
    flag1.src = await readFile(f);
  });

  fl2Input.addEventListener('change', async e=>{
    const f = e.target.files[0];
    if(!f) return;
    flag2.src = await readFile(f);
  });

  scanInput.addEventListener('change', async e=>{
    const f = e.target.files[0];
    if(!f) return;
    scanImg.src = await readFile(f);
  });

  document.getElementById('previewBtn').addEventListener('click',()=>{
    updatePreview();
    alert("Preview updated!");
  });

  document.getElementById('generate').addEventListener('click', async()=>{

    if(!photoInput.files[0]){
      alert("Upload a photo first!");
      return;
    }

    updatePreview();

    const preview = document.getElementById('preview');
    const cloned = preview.cloneNode(true);

    // copy photo
    cloned.querySelector('#photoPreview').style.backgroundImage =
      getComputedStyle(photoPreview).backgroundImage;

    cloned.querySelector('#coaImg').src = coaImg.src;
    cloned.querySelector('#flag1').src = flag1.src;
    cloned.querySelector('#flag2').src = flag2.src;
    cloned.querySelector('#scanImg').src = scanImg.src;

    const wrapper = document.createElement('div');
    wrapper.style.width="210mm";
    wrapper.appendChild(cloned);

    const off = document.createElement('div');
    off.style.position="fixed";
    off.style.left="-9999px";
    off.appendChild(wrapper);
    document.body.appendChild(off);

    await html2pdf()
      .set({
        margin:[10,10,10,10],
        filename: nameEl.value+"_floptropica_passport.pdf",
        html2canvas:{scale:2,scrollY:0},
        jsPDF:{unit:"mm",format:"a4"}
      })
      .from(wrapper)
      .save();

    document.body.removeChild(off);
  });

  updatePreview();
})();
</script>

</body>
</html>