<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FlopRate Certificate Generator</title>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #ffffff;
        padding: 20px;
        color: #222;
        max-width: 600px;
        margin: auto;
    }

    h1 {
        text-align: center;
        margin-bottom: 30px;
    }

    label {
        font-weight: bold;
        display: block;
        margin-top: 15px;
        margin-bottom: 5px;
    }

    input, select {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 6px;
        background: #fff;
        color: #222;
    }

    button {
        margin-top: 25px;
        width: 100%;
        padding: 12px;
        font-size: 17px;
        font-weight: bold;
        border: none;
        border-radius: 6px;
        background: #d40000;
        color: white;
        cursor: pointer;
        transition: 0.2s;
    }

    button:hover {
        background: #b30000;
    }
</style>
</head>
<body>

<h1>FlopRate Certificate Generator</h1>

<label>Show or Movie Title</label>
<input type="text" id="title" placeholder="Enter the title">

<label>Age Rating</label>
<select id="rating">
    <option value="1.png">FR-K (1.png)</option>
    <option value="2.png">FR-PG (2.png)</option>
    <option value="3.png">FR-T (3.png)</option>
    <option value="4.png">FR-R (4.png)</option>
</select>

<button onclick="makePDF()">Done</button>

<script>
async function makePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
        orientation: "portrait",
        unit: "pt",
        format: "a4"
    });

    const title = document.getElementById("title").value;
    const ratingImgFile = document.getElementById("rating").value;

    // External images
    const floprateLogo = await toDataURL("https://floprate.netlify.app/logo.png");
    const fwbLogo = await toDataURL("https://floprate.netlify.app/fwb.png");

    // Rating image (replace URLs with your folder later)
    const ratingImg = await toDataURL("https://floprate.netlify.app/" + ratingImgFile);

    // ---------- TOP LOGO ----------
    doc.addImage(floprateLogo, "PNG", 160, 40, 250, 0); // height auto (keeps ratio)

    // ---------- TEXT ----------
    doc.setFont("Helvetica", "normal");
    doc.setFontSize(22);

    doc.text("Your show:", 50, 260);

    doc.setFontSize(28);
    doc.text(title || "__________________________", 50, 300);

    doc.setFontSize(22);
    doc.text("has been awarded this age rating by our team:", 50, 350);

    // ---------- RATING IMAGE ----------
    doc.addImage(ratingImg, "PNG", 50, 380, 200, 0); // auto height

    // ---------- BOTTOM LOGO ----------
    doc.addImage(fwbLogo, "PNG", 160, 520, 250, 0); // auto height

    // Save PDF
    doc.save("FlopRate-Certificate.pdf");
}

// Convert external URL â†’ dataURL to bypass jsPDF restrictions
function toDataURL(url) {
    return new Promise((resolve) => {
        const img = new Image();
        img.crossOrigin = "Anonymous";
        img.onload = () => {
            const canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);
            resolve(canvas.toDataURL("image/png"));
        };
        img.src = url;
    });
}
</script>

</body>
</html>